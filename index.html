<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
  <link rel="stylesheet" href="/styles/reset.css">
  <link rel="stylesheet" href="/styles/common.css">
  <style>
    .table thead th {
      border-bottom: none;
    }

    .table td,
    .table th {
      border-top: none;
    }
  </style>
</head>

<body>
  <main id="app" class="container-fluid p0 d-flex flex-column" style="min-height:100vh;">
    <header id="header" class="d-flex flex-row bg-dark border-bottom">
      <button type="button" class="btn btn-primary border-right">
        <img src="/assets/classification.png" title="classification" width="39" height="29" class="ml-2 mr-2" />
      </button>
      <div class="d-flex flex-row pt-4 pb-4" style="flex: 1;">
        <img src="/assets/aboo.png" title="aboo" width="32" height="42" class="ml-4 mr-4" />
        <h3 class="text-white">阿布跑跑大数据中心</h3>
      </div>
      <div class="user-continer d-flex align-items-center text-white ml-4 mr-4 pointer">
        <button type="button" data-toggle="modal" data-target="#loginModal">登录</button>
      </div>
    </header>
    <div class="d-flex flex-row" style="flex: 1;">
      <div class="d-flex flex-row relative slider-dialog-container">
        <nav class="nav d-flex flex-column bg-dark border-right">
          <a class="nav-link text-light d-flex flex-column align-items-center mt-2 mb-2 pl-2 pr-2 home-button" href="javascript:void(0);">
            <img src="/assets/home.png" title="home" width="38" height="30"><p class="pt-2">首页</p></a>
          <a class="nav-link text-light d-flex flex-column align-items-center mt-2 mb-2 pl-2 pr-2" href="/control.html">
            <img src="/assets/conctrol.png" title="conctrol" width="38" height="34"><p class="pt-2">控制中心</p></a>
          <a class="nav-link text-light d-flex flex-column align-items-center mt-2 mb-2 pl-2 pr-2" href="#">
            <img src="/assets/trajectory.png" title="trajectory" width="38" height="40"><p class="pt-2">轨迹管理</p></a>
          <a class="nav-link text-light d-flex flex-column align-items-center mt-2 mb-2 pl-2 pr-2" href="#">
            <img src="/assets/movement.png" title="movement" width="40" height="38"><p class="pt-2">运动数据</p></a>
          <a class="nav-link text-light d-flex flex-column align-items-center mt-2 mb-2 pl-2 pr-2" href="#">
            <img src="/assets/user.png" title="user" width="39" height="39"><p class="pt-2">用户分析</p></a>
        </nav>
        <div class="slider-dialog bg-dark shadow-right-big text-white" style="z-index: 999; width: 368px; display: none;">
          <h5 class="d-flex justify-content-between text-light m-4">查看设备数量
            <!-- <img src="/assets/close.png" title="close" class="slider-close pointer" width="15" height="15"> -->
          </h5>
          <div class="border-bottom p-4 mb-3">
            <p class="text-muted d-flex align-items-center mb-3">全部显示
              <button type="button" class="ml-2 btn btn-primary btn-sm">NO</button>
            </p>
            <p class="text-muted">当前视野设备数量：<span class="text-white visible-maker">??</span></p>
          </div>
          <div class="p-4 mb-3">
            <div class="row-between border">
              <input type="text" class="p-2 text-white nav-search" placeholder="输入关键字" />
              <button type="button" class="border-left pl-3 pt-1 pb-1 pr-3">
                <img src="/assets/search.png" title="search" width="18p" height="18" />
              </button>
            </div>
          </div>
          <ul class="nav justify-content-center nav-tab-container">
          </ul>
          <ul class="p-3 fixing-container">
          </ul>
          <ul class="pagination-container d-flex justify-content-center" id="pagination"></ul>
        </div>
        <button class="slider-doork absolute-middle-right pointer" style="right: 1px; z-index: 999; transform: translateX(100%);">
          <img src="/assets/extension.png" alt="extension">
        </button>
      </div>
      <div id="allmap" class="d-flex relative" style="flex: 1;"></div>
    </div>
  </main>
  <!-- Modal-->
  <div class="modal fade" id="loginModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">用户登录</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form class="login-form">
          <div class="modal-body">
            <div class="form-group">
              <label for="exampleInputEmail1">手机号码</label>
              <input type="phone" class="form-control" id="username" aria-describedby="userHelp" placeholder="请输入手机号码">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">密码</label>
              <input type="password" class="form-control" id="password" placeholder="请输入密码">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary login-button">登录</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
          </div>
          </from>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=wLO6NCPlns2pGqpmQh9itlCwcz1M8Og3"></script>
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdn.bootcss.com/qs/6.5.2/qs.js"></script>
  <script type="text/javascript" src="/lib/jqpaginator.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script type="text/javascript" src="/js/common.js"></script>
  <script type="text/javascript" src="/js/event.js"></script>
  <script type="text/javascript" src="/js/home.js"></script>
  <script>

    var login = (function () {
      var userInfo = null,
        $loginForm = $('.login-form')

      $loginForm.submit(function (e) {
        e.preventDefault()
        let $currentTartget = $(e.currentTarget),
          username = $currentTartget.find('#username').val(),
          password = $currentTartget.find('#password').val()
        AdminLoginAccount({ username, password })
      })

      function AdminLoginAccount({ username, password }) {
        return axios.post('/AdminLoginAccount', Qs.stringify({ username, password })).then(res => {
          if (res.data.ret == 1002) return window.alert(res.data.code)
          if (res.data.ret == 1003) return window.alert(res.data.code)
          userInof = res.data
          _SetLoaclStorageUserInfo(res.data)
          Event.trigger('setUserInfo')
          $('#loginModal').modal('hide')
        })
      }
      function _SetLoaclStorageUserInfo(userInfo) {
        window.localStorage.setItem('userinfo', JSON.stringify(userInfo))
      }
      function GetLoaclStorageUserInfo() {
        userInfo = JSON.parse(window.localStorage.getItem('userinfo'))
        if (userInfo) {
          Event.trigger('setUserInfo')
          return true
        }
        return false
      }
      function GetUserInfo() {
        return userInfo
      }
      return {
        AdminLoginAccount,
        GetLoaclStorageUserInfo,
        GetUserInfo
      }
    }())
    Event.listen('setUserInfo', () => {
      let userInfo = login.GetUserInfo(),
        $userContainer = $('.user-continer')
      console.log(userInfo)
      let $userInfo = $(`
        <img src="/assets/default.png" wdith="48" height="48" />
        <div class="dropdown mr-2 ml-2">
          <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            ${userInfo.UserName}
          </button>
        </div>
      `)
      $userContainer.html($userInfo)
    })
    Event.listen('setNavTab', () => {

    })
    Event.listen('setFixingLists', () => {

    })
    Event.listen('setPagination', () =>{

    })
    Event.listen('setMapMakerPoint', () => {

    })
    login.GetLoaclStorageUserInfo()
    // home.GetFixingList()


  </script>

</body>

</html>